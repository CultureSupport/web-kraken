<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Culture.Support</title>
    <!-- Last inn Tailwind CSS for rask styling og Gridbox -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1f2937, #0f172a);
            min-height: 100vh;
            display: grid;
            place-items: center;
        }
        .robot-card {
            /* Simulerer Gridbox for layout og responsivitet */
            display: grid;
            grid-template-rows: auto 1fr auto;
            perspective: 1000px; /* For 3D transform */
            transition: all 0.5s ease-in-out;
        }
        .transform-active {
            transform: rotateY(5deg) scale(1.02); /* 3D transformasjon */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }
        .circular-element {
            /* Den sirkul칝re teknologien/designelementet */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at center, #6366f1, #3b82f6);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.7);
            color: white;
            font-weight: bold;
            font-size: 2.5rem;
            animation: pulse 2s infinite alternate;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 15px rgba(99, 102, 241, 0.7); }
            100% { transform: scale(1.05); box-shadow: 0 0 30px rgba(59, 130, 246, 1); }
        }
        .suggestion-item {
            border-left: 4px solid;
            padding-left: 1rem;
            margin-bottom: 1rem;
            transition: background-color 0.3s;
        }
        .suggestion-item:hover {
            background-color: #1e293b;
        }
    </style>
</head>
<body class="p-4">

    <div id="robot-app" class="robot-card max-w-4xl w-full mx-auto p-6 bg-gray-800 rounded-2xl shadow-2xl space-y-6">

        <!-- Robot Hode / Status -->
        <div class="flex flex-col items-center justify-center text-center pb-4 border-b border-gray-700">
            <div class="circular-element mb-4">
                游
            </div>
            <h1 class="text-3xl font-bold text-white mb-1">Dialogrobot V1.0</h1>
            <p class="text-gray-400">Genererer 5 App-Modeller basert p친 dine utviklings칮nsker (Transistor API)</p>
        </div>

        <!-- Input Seksjon -->
        <div class="space-y-4">
            <label for="developmentWish" class="block text-lg font-medium text-gray-200">
                1. Beskriv ditt utviklings칮nske:
            </label>
            <textarea id="developmentWish" rows="4" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" placeholder="F.eks. 'Jeg 칮nsker en app for 친 spore karbonavtrykket mitt' eller 'Hvordan kan jeg bygge en ny type sosialt nettverk?'"></textarea>
            
            <button id="generateButton" onclick="generateAppIdeas()" class="w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-md transition duration-200 disabled:opacity-50 flex items-center justify-center">
                <svg id="loadingSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Generer 5 App-Modeller
            </button>
        </div>

        <!-- Resultat Seksjon -->
        <div id="resultsSection" class="pt-6 hidden">
            <h2 class="text-2xl font-semibold text-white mb-4 border-b pb-2 border-indigo-500">
                2. Genererte App-Modeller (5 Forslag)
            </h2>
            <div id="appSuggestions" class="space-y-4">
                <!-- Forslagene vil bli satt inn her av JavaScript -->
            </div>
        </div>

        <!-- Melding Boks for Feil/Info (erstatter alert()) -->
        <div id="messageBox" class="p-3 bg-red-800 text-white rounded-lg mt-4 hidden" role="alert">
            <!-- Meldinger vil bli satt inn her -->
        </div>

    </div>

    <script type="module">
        // MARK: - Firestore/Firebase Imports and Setup (Ikke n칮dvendig for denne appen, men standard struktur beholdes)
        // I henhold til instruksjonene dropper vi Firestore for denne spesifikke generative appen, da den ikke krever persistent lagring.
        
        // Globale variabler for Canvas/LLM
        const apiKey = ""; 
        const modelName = "gemini-2.5-flash-preview-09-2025";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

        // Hjelpefunksjon for 친 h친ndtere nettverksforesp칮rsler med eksponentiell backoff
        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API error (${response.status}): ${JSON.stringify(errorData)}`);
                    }
                    return response;
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error.message);
                    if (i === maxRetries - 1) throw error; 
                    const delayTime = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delayTime));
                }
            }
        }

        // MARK: - App-Spesifikk Logikk (App Generasjonsrobot)

        const appCard = document.getElementById('robot-app');
        const wishInput = document.getElementById('developmentWish');
        const generateBtn = document.getElementById('generateButton');
        const resultsSection = document.getElementById('resultsSection');
        const suggestionsContainer = document.getElementById('appSuggestions');
        const messageBox = document.getElementById('messageBox');

        // Legg til 3D-transformasjonseffekt
        appCard.addEventListener('mouseenter', () => appCard.classList.add('transform-active'));
        appCard.addEventListener('mouseleave', () => appCard.classList.remove('transform-active'));

        function showMessage(message, isError = false) {
            messageBox.textContent = message;
            messageBox.className = `p-3 text-white rounded-lg mt-4 ${isError ? 'bg-red-600' : 'bg-green-600'}`;
            messageBox.classList.remove('hidden');
        }

        function clearMessage() {
            messageBox.classList.add('hidden');
        }

        window.generateAppIdeas = async function() {
            const userWish = wishInput.value.trim();
            if (!userWish) {
                showMessage("Vennligst beskriv ditt utviklings칮nske f칮r du genererer.", true);
                return;
            }

            // Vis laste-indikator og deaktiver knapp
            generateBtn.disabled = true;
            document.getElementById('loadingSpinner').classList.remove('hidden');
            clearMessage();
            suggestionsContainer.innerHTML = '';
            resultsSection.classList.add('hidden');

            const systemPrompt = "Du er en kreativ utviklingsrobot. Din oppgave er 친 generere 5 unike og innovative app-ideer ('App Models') basert p친 et gitt utviklings칮nske. Hver id칠 skal ha et kort navn og en detaljert beskrivelse. Svar utelukkende med en JSON-array som f칮lger det angitte skjemaet. Tekstene skal v칝re p친 norsk.";
            const userQuery = `Utviklings칮nske: ${userWish}`;

            // JSON Schema for 친 sikre at vi f친r 5 strukturerte forslag (5 generator forslag app)
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                "navn": { "type": "STRING", "description": "Et kort, fengende navn for app-modellen." },
                                "beskrivelse": { "type": "STRING", "description": "En kort, detaljert beskrivelse av app-modellen og dens funksjon, maksimalt 3 setninger." }
                            },
                            required: ["navn", "beskrivelse"]
                        }
                    }
                }
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 && 
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    const jsonString = result.candidates[0].content.parts[0].text;
                    const appIdeas = JSON.parse(jsonString);

                    if (Array.isArray(appIdeas) && appIdeas.length > 0) {
                        renderSuggestions(appIdeas);
                        resultsSection.classList.remove('hidden');
                    } else {
                        showMessage("Generatoren returnerte ingen gyldige forslag. Pr칮v en annen beskrivelse.", true);
                    }

                } else {
                    showMessage("Fikk ingen respons fra generatoren. Kontroller nettverkstilkoblingen eller pr칮v igjen.", true);
                }

            } catch (error) {
                console.error("Feil under API-kall:", error);
                showMessage(`Klarte ikke 친 generere ideer: ${error.message.substring(0, 100)}...`, true);
            } finally {
                // Skjul laste-indikator og reaktiver knapp
                generateBtn.disabled = false;
                document.getElementById('loadingSpinner').classList.add('hidden');
            }
        }

        function renderSuggestions(ideas) {
            suggestionsContainer.innerHTML = ideas.map((idea, index) => `
                <div class="suggestion-item border-indigo-400 p-4 rounded-lg bg-gray-900 shadow-md">
                    <h3 class="text-xl font-bold text-indigo-400 mb-1">
                        ${index + 1}. ${idea.navn || 'Ukjent App Navn'}
                    </h3>
                    <p class="text-gray-300">
                        ${idea.beskrivelse || 'Ingen beskrivelse tilgjengelig.'}
                    </p>
                </div>
            `).join('');
            
        }

        window.onload = () => {
             // S칮rg for at alt er lastet, selv om det ikke er Firestore-avhengig
             console.log("Dialogroboten er klar for innspill!");
        };

    </script>

</body>
</html>

